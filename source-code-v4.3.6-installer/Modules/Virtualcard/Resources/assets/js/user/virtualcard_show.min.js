"use strict";var isMasked="yes";const modalElement=document.getElementById("exampleModal"),modalInstance=new bootstrap.Modal(modalElement);let eyeOnIcon=$(".eye-on"),eyeOffIcon=$(".eye-off"),loaderIcon=$(".loaderIcon");$(eyeOffIcon).show();let $btn=$("#sendOtpBtn");if($("#sendOtpBtn").on("click",(function(){$(loaderIcon).removeClass("d-none"),$(eyeOffIcon).addClass("d-none"),fetch(sendOtpUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({virtualcardId:virtualcardId,_token:_token})}).then((e=>e.json())).then((e=>{e.success?modalInstance.show():(swal({title:failedTitle,text:failedText,type:"error"}),$(eyeOnIcon).removeClass("d-none"),$(loaderIcon).addClass("d-none"))})).catch((e=>{swal({title:failedTitle,text:errorText,type:"error"}),$(eyeOnIcon).removeClass("d-none"),$(loaderIcon).addClass("d-none")})).finally((()=>{$btn.attr("disabled",!1)}))})),document.getElementById("exampleModal").addEventListener("hidden.bs.modal",(function(){$(loaderIcon).addClass("d-none"),"yes"==isMasked?$(eyeOffIcon).removeClass("d-none"):$(eyeOnIcon).removeClass("d-none")})),"true"===localStorage.getItem("cardUnmasked_"+virtualcardId)){const e=localStorage.getItem("cardNumber_"+virtualcardId),t=localStorage.getItem("cvc_"+virtualcardId),a=localStorage.getItem("cardId_"+virtualcardId);e&&a===virtualcardId&&(unmaskCard(e,t,a),$(eyeOnIcon).removeClass("d-none"),$(eyeOffIcon).addClass("d-none"))}function unmaskCard(e,t,a){cardUnmasked||($("#card-number").text(formatCardNumber(e)),$("#card-cvc").addClass("text-xs"),$("#card-cvc").text(t),cardUnmasked=!0,isMasked="no",localStorage.setItem("cardUnmasked_"+virtualcardId,"true"),localStorage.setItem("cardNumber_"+virtualcardId,e),localStorage.setItem("cvc_"+virtualcardId,t),localStorage.setItem("cardId_"+virtualcardId,a),localStorage.setItem("isMasked_"+virtualcardId,"no"),maskTimeout=setTimeout(maskCard,6e4))}function maskCard(){$("#card-number").text(maskCardNumber(localStorage.getItem("cardNumber_"+virtualcardId))),$("#card-cvc").removeClass("text-xs"),$("#card-cvc").text("*".repeat(localStorage.getItem("cvc_"+virtualcardId).length)),cardUnmasked=!1,isMasked="yes",$(eyeOffIcon).removeClass("d-none"),$(eyeOnIcon).addClass("d-none"),localStorage.removeItem("cardUnmasked_"+virtualcardId),localStorage.removeItem("cardNumber_"+virtualcardId),localStorage.removeItem("cardId_"+virtualcardId),localStorage.removeItem("cvc_"+virtualcardId),localStorage.removeItem("isMasked_"+virtualcardId)}function maskCardNumber(e){if((e=String(e)).length>=4){return"*".repeat(e.length-4)+e.slice(-4)}return e}function formatCardNumber(e){return(e=String(e)).replace(/(\d{4})(?=\d)/g,"$1 ")}$("#verifyOtpBtn").on("click",(()=>{$(".spinner").removeClass("d-none");const e=$("#verificationCode").val();fetch(verifyOtpUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otp:e,_token:_token})}).then((e=>e.json())).then((e=>{e.success?(e.virtualcardId==virtualcardId&&unmaskCard(e.cardNumber,e.cvc,e.virtualcardId),modalInstance.hide(),$(".otp-input").val("")):(swal({title:failedTitle,text:e.message?e.message:invalidOTP,type:"error"}),$(".otp-input").val(""))})).catch((e=>{swal({title:failedTitle,text:errorText,type:"error"})})).finally((()=>{$(".spinner").addClass("d-none")}))})),eyeOnIcon.on("click",(function(){maskCard()}));var otpInputs=document.querySelectorAll(".otp-input");function setupOtpInputListeners(e){e.forEach((function(t,a){t.addEventListener("paste",(function(t){var a=t.clipboardData.getData("text").trim();if(/^\d{6}$/.test(a)){var r=a.split("");e.forEach((function(e,t){e.value=r[t]||""})),enableNextBox(e[0],0),e[5].removeAttribute("disabled"),e[5].focus(),updateOTPValue(e)}else t.preventDefault()})),t.addEventListener("input",(function(){var t=Array.from(e).indexOf(this),a=this.value.trim();/^\d$/.test(a)?(a&&t<5&&(e[t+1].removeAttribute("disabled"),e[t+1].focus()),4===t&&a&&(e[5].removeAttribute("disabled"),e[5].focus()),updateOTPValue(e)):this.value=""})),t.addEventListener("keydown",(function(t){var a=Array.from(e).indexOf(this);!this.value&&"Backspace"===t.key&&a>0&&e[a-1].focus()}))}))}function updateOTPValue(e){var t="";e.forEach((function(e){t+=e.value})),e===otpInputs&&(document.getElementById("verificationCode").value=t)}setupOtpInputListeners(otpInputs),otpInputs[0].focus();