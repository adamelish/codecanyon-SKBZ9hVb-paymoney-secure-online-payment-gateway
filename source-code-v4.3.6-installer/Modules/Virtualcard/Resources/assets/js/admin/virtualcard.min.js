"use strict";function restrictNumberToPrefdecimalOnInput(t){restrictNumberToPrefdecimal(t,currency.type)}function formatNumberToPrefDecimal(t=0){let e="fiat"==currency.type?decimalFormate:caryptoFormate;return Math.abs(t).toFixed(e)}if($(".content").find("#index-section").length&&(document.querySelector("form").addEventListener("submit",function(t){t.preventDefault();let e=new URLSearchParams(new FormData(this)),n=`${SITE_URL}/${ADMIN_PREFIX}/virtualcards?${e.toString().replace(/%5B/g,"[").replace(/%5D/g,"]")}`;window.location.href=n}),$("#csv").on("click",function(t){t.preventDefault();var e=$("#startfrom").val(),n=$("#endto").val(),r=$("#brand").val(),a=$("#currency").val(),o=$("#status").val();window.location=SITE_URL+"/"+ADMIN_PREFIX+"/virtualcards/csv?filter[from]="+e+"&filter[to]="+n+"&filter[brand]="+r+"&filter[currency]="+a+"&filter[status]="+o}),$("#pdf").on("click",function(t){var e=$("#startfrom").val(),n=$("#endto").val(),r=$("#brand").val(),a=$("#currency").val(),o=$("#status").val();window.location=SITE_URL+"/"+ADMIN_PREFIX+"/virtualcards/pdf?filter[from]="+e+"&filter[to]="+n+"&filter[brand]="+r+"&filter[currency]="+a+"&filter[status]="+o})),$(".content").find("#edit-section").length){let t=null,e="";function n(t){restrictNumberToPrefdecimal(t,$("select#currencyCode").find(":selected").data("type"))}function r(t=0){let e="fiat"==$("select#currencyCode").find(":selected").data("type")?decimalFormate:caryptoFormate;return Math.abs(t).toFixed(e)}function a(t,e){return new Promise((n,r)=>{$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"GET",url:ADMIN_URL+"/virtualcard/providers/"+t+"/get-currencies",dataType:"json",success:function(t){let r="";$.each(t.currencies,(t,n)=>{r+=`<option value="${n.code}" data-type="${n.type}" ${n.code==e?"selected":""}>${n.code}</option>`}),$("#currencyCode").html(r),n(t)},error:function(t){r(t)}})})}$("#virtualcardProviderId").on("change",function(){a(t=$(this).val(),e=$("#oldVirtualcardCurrencyCode").val())}),$("#cardExpiryDate").daterangepicker({singleDatePicker:!0,locale:{format:"DD-M-YYYY"}}),$(document).on("submit","#virtualCardUpdateBtnForm",function(){$("#virtualCardUpdateBtn").attr("disabled",!0),$(".fa-spinner").removeClass("d-none"),$("#virtualCardUpdateBtnText").text(submitButtonText)}),$(function(){let t=$("#cardNumber"),e=$("#cardLogo");t.on("input",function(){let n=t.val().replace(/\D/g,"");n=n.replace(/(.{4})/g,"$1 ").trim(),t.val(n);let r=function t(e){for(let[n,r]of Object.entries({visa:/^4/,mastercard:/^5[1-5]/,amex:/^3[47]/,discover:/^6(?:011|5)/,diners:/^3(?:0[0-5]|[68])/,jcb:/^(?:2131|1800|35)/,unionpay:/^(62)/}))if(r.test(e))return n;return""}(n.replace(/\s/g,""));r&&logoUrls[r]?(e.attr("src",logoUrls[r]).show(),t.css("padding-left","55px")):(e.hide(),t.css("padding-left","15px"))}),t.trigger("input")}),$(window).on("load",function(){a(t=$("#virtualcardProviderId").val(),e=$("#oldVirtualcardCurrencyCode").val()).then(()=>{var t=r($("#amount").val()),e=r($("#cardSpendingLimit").val());$("#amount").val(t),$("#cardSpendingLimit").val(e)})})}if($(".content").find("#show-section").length){$(".card-warning").on("click",function(t){t.preventDefault();let e=$(this).attr("href");"Decline"==$(this).text()?($(".modal-title").text(declineTitle),$(".modal-text").text(declineText)):($(".modal-title").text(approveTitle),$(".modal-text").text(approveText)),$("#card-modal-yes").attr("href",e),$("#card-warning-modal").modal("show")}),$(document).on("click",".card-action",function(t){t.preventDefault();let e=$(this).attr("data-action"),n=$(this).attr("data-cardid"),r="active"==e?actionActiveText:actionDeactiveText,a="active"==e?actionActiveButtonText:actionDeactiveButtonText;Swal.fire({title:actionTitle,text:r,icon:"warning",showCancelButton:!0,confirmButtonColor:"#635BFF",cancelButtonColor:"#DF3B3B",confirmButtonText:a}).then(t=>{t.isConfirmed&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:cardActionUrl,type:"POST",data:{action:e,virtuacardId:n},beforeSend:function(){Swal.fire({title:pleaseWaitText,text:loadingText,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,willOpen(){Swal.showLoading()}})},success:function(t){t.status?Swal.fire({title:t.title,text:t.message,icon:"success"}).then(()=>{location.reload()}):Swal.fire(errorText,t.message,"error")},error:function(t){Swal.fire(somethingWentWrongText,"error")}})})});let o=new URL(window.location.href),i=o.pathname.split("/"),l=i.pop(),s=[];fetch(spendingControlLimitUrl+`?virtualcardId=${l}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{t?(s=t,g()):Swal.fire({title:errorText,text:unexpectedErrorText,icon:"error"}).then(()=>{location.reload()})}).catch(t=>{Swal.fire({title:errorText,text:unexpectedErrorText,icon:"error"}).then(()=>{location.reload()})});let c=document.querySelector(".spendingLimits"),d=document.getElementById("amount"),u=document.getElementById("interval"),f=document.querySelector(".btn.btn-secondary"),p=document.querySelector(".spendingControlBtn"),m={EVERY_AUTHORIZATION:"per_authorization",EVERY_DAY:"daily",EVERY_WEEK:"weekly",EVERY_MONTH:"monthly",EVERY_YEAR:"yearly",ALL_TIME:"all_time"};function v(t){let e="";switch(t.interval){case m.EVERY_DAY:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitPerText} ${dayText}`;break;case m.EVERY_WEEK:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitPerText} ${weekText}`;break;case m.EVERY_MONTH:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitPerText} ${monthText}`;break;case m.EVERY_YEAR:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitPerText} ${yearText}`;break;case m.ALL_TIME:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitInText} ${totalText}`;break;case m.EVERY_AUTHORIZATION:default:e=`ðŸ’³${limitText} | <strong>${currency.symbol} ${parseFloat(t.amount).toFixed(2)}</strong> ${limitPerText} ${authorizationText}`}return e}function g(){c.innerHTML="",s.forEach((t,e)=>{c.innerHTML+=`
                <li class="list-group-item d-flex align-items-center f-14" data-index="${e}">
                    <div class="flex-grow-1">
                    ${v(t)}
                    </div>
                    <button class="btn-close" aria-label="Close"></button>
                </li>
            `})}c.addEventListener("click",function(t){if(t.target.classList.contains("btn-close")){let e=t.target.closest("li").getAttribute("data-index");s.splice(e,1),g()}}),f.addEventListener("click",function(t){t.preventDefault();let e=d.value.trim(),n=u.value;if(!e||0>=parseFloat(e)){alert(validAmountText);return}fetch(spendingControlExistCheckUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_token,amountValue:e,intervalValue:n,virtualcardId:l,cardSpendingLimit:s})}).then(t=>t.json()).then(t=>{if(t.status)$(".spendingControlError").text(t.message),$(".spendingControlError").removeClass("d-none"),$(".spendingControlBtn").attr("disabled",!0);else{$(".spendingControlError").text(""),$(".spendingControlError").addClass("d-none"),$(".spendingControlBtn").attr("disabled",!1);let r=`${parseFloat(e).toFixed(2)}`;s.push({amount:r,interval:n}),g(),d.value="",u.selectedIndex=0}})}),p.addEventListener("click",function(t){t.preventDefault(),$(".fa-spin").removeClass("d-none"),$(this).attr("disabled",!0),$(".spendingControlBtnText").text(updatingText),fetch(spendingControlLimitUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_token,virtualcardId:l,cardSpendingLimit:s})}).then(t=>t.json()).then(t=>{t.status?($(".spendingControlError").text(""),$(".spendingControlError").addClass("d-none"),Swal.fire({title:t.title,text:t.message,icon:"success"}).then(()=>{location.reload()})):($(".spendingControlError").text(t.message),$(".spendingControlError").removeClass("d-none"))}).catch(t=>{Swal.fire({title:errorText,text:unexpectedErrorText,icon:"error"})}).finally(()=>{$(".fa-spin").addClass("d-none"),$(this).attr("disabled",!1),$(".spendingControlBtnText").text(saveChangeText)})})}
